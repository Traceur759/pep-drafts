<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="generator" content="Docutils 0.12: http://docutils.sourceforge.net/" />
  <title>PEP A -- Distributing a Subset of the Standard Library</title>
  <style type="text/css">

/*
:Author: David Goodger
:Contact: goodger@python.org
:date: $Date: 2006-05-21 14:44:42 -0600 (Sun, 21 May 2006) $
:version: $Revision: 4564 $
:copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the PEP HTML output of Docutils.
*/

/* "! important" is used here to override other ``margin-top`` and
   ``margin-bottom`` styles that are later in the stylesheet or 
   more specific.  See http://www.w3.org/TR/CSS1#the-cascade */
.first {
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.navigation {
  width: 100% ;
  background: #99ccff ;
  margin-top: 0px ;
  margin-bottom: 0px }

.navigation .navicon {
  width: 150px ;
  height: 35px }

.navigation .textlinks {
  padding-left: 1em ;
  text-align: left }

.navigation td, .navigation th {
  padding-left: 0em ;
  padding-right: 0em ;
  vertical-align: middle }

.rfc2822 {
  margin-top: 0.5em ;
  margin-left: 0.5em ;
  margin-right: 0.5em ;
  margin-bottom: 0em }

.rfc2822 td {
  text-align: left }

.rfc2822 th.field-name {
  text-align: right ;
  font-family: sans-serif ;
  padding-right: 0.5em ;
  font-weight: bold ;
  margin-bottom: 0em }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

body {
  margin: 0px ;
  margin-bottom: 1em ;
  padding: 0px }

dl.docutils dd {
  margin-bottom: 0.5em }

div.section {
  margin-left: 1em ;
  margin-right: 1em ;
  margin-bottom: 1.5em }

div.section div.section {
  margin-left: 0em ;
  margin-right: 0em ;
  margin-top: 1.5em }

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.footer {
  margin-left: 1em ;
  margin-right: 1em }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin-left: 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1 {
  font-family: sans-serif ;
  font-size: large }

h2 {
  font-family: sans-serif ;
  font-size: medium }

h3 {
  font-family: sans-serif ;
  font-size: small }

h4 {
  font-family: sans-serif ;
  font-style: italic ;
  font-size: small }

h5 {
  font-family: sans-serif;
  font-size: x-small }

h6 {
  font-family: sans-serif;
  font-style: italic ;
  font-size: x-small }

hr.docutils {
  width: 75% }

img.align-left {
  clear: left }

img.align-right {
  clear: right }

img.borderless {
  border: 0 }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-family: sans-serif ;
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font-family: serif ;
  font-size: 100% }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.option-argument {
  font-style: italic }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

td.num {
  text-align: right }

th.field-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body bgcolor="white">
<table class="navigation" cellpadding="0" cellspacing="0"
       width="100%" border="0">
<tr><td class="navicon" width="150" height="35">
<a href="http://www.python.org/" title="Python Home Page">
<img src="http://www.python.org/pics/PyBanner000.gif" alt="[Python]"
 border="0" width="150" height="35" /></a></td>
<td class="textlinks" align="left">
[<b><a href="http://www.python.org/">Python Home</a></b>]
[<b><a href="index.html">PEP Index</a></b>]
[<b><a href="https://github.com/fedora-python/pep-drafts/blob/master/pep-A.rst">PEP Source</a></b>]
</td></tr></table>
<div class="document">
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">XXX</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Distributing a Subset of the Standard Library</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body">$Date$</td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Tomáš Orsava &lt;<a class="reference external" href="mailto:torsava&#64;redhat.com">torsava&#64;redhat.com</a>&gt;,
Petr Viktorin &lt;<a class="reference external" href="mailto:pviktori&#64;redhat.com">pviktori&#64;redhat.com</a>&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Draft</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body">text/x-rst</td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">5-Sep-2016</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">3.6</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id8">Abstract</a></li>
<li><a class="reference internal" href="#motivation" id="id9">Motivation</a><ul>
<li><a class="reference internal" href="#cpython" id="id10">CPython</a></li>
<li><a class="reference internal" href="#linux-and-other-distributions" id="id11">Linux and other distributions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specification" id="id12">Specification</a></li>
<li><a class="reference internal" href="#rationale" id="id13">Rationale</a></li>
<li><a class="reference internal" href="#backwards-compatibility" id="id14">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#reference-implementation" id="id15">Reference Implementation</a></li>
<li><a class="reference internal" href="#references" id="id16">References</a></li>
<li><a class="reference internal" href="#copyright" id="id17">Copyright</a></li>
</ul>
</div>
<div class="warning">
<p class="first admonition-title">Warning</p>
<p class="last">TODO
1. Don't forget 2 spaces after every sentence (Python developers should really read a manual of style).
2. Text should be longer than 70 but no longer than 79 characters.</p>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id8">Abstract</a></h1>
<div class="admonition">
<p class="first admonition-title">XXX</p>
<p>Write this last :)</p>
<p>(~200 words)</p>
<p class="last">This PEP should handle step <tt class="docutils literal">1)</tt> from the initial discussion (link?).</p>
</div>
</div>
<div class="section" id="motivation">
<h1><a class="toc-backref" href="#id9">Motivation</a></h1>
<!-- The motivation is critical for PEPs that want to change the Python language.  It should clearly explain why the existing language specification is inadequate to address the problem that the PEP solves.  PEP submissions without sufficient motivation may be rejected outright. -->
<p>There are several use cases for including only a subset of Python's standard library.  For example, when a <em>stdlib</em> module with missing dependencies is skipped during the Python build process.  For another, a considerable amount of space can be saved by not distributing irrelevant parts of the standard library, such as <tt class="docutils literal">TkInter</tt> on headless servers.</p>
<p>However, there is so far no formal specification of how to properly implement distribution of a subset of the standard library.  Namely, how to safely handle attempts to import a missing <em>stdlib</em> module, and display an informative error message.</p>
<div class="section" id="cpython">
<h2><a class="toc-backref" href="#id10">CPython</a></h2>
<p>When one of Python standard library modules (such as <tt class="docutils literal">_sqlite3</tt>) cannot be compiled during a Python build because of missing dependencies (e.g. SQLite header files), the module is simply skipped.</p>
<p>If you then install this compiled Python and use it to try to import one of the missing modules, Python will go through the <tt class="docutils literal">sys.path</tt> entries looking for it.  It won't find it among the <em>stdlib</em> modules and thus it will continue onto <tt class="docutils literal"><span class="pre">site-packages</span></tt> and fail with an <tt class="docutils literal">ImportError</tt> if it doesn't find it.</p>
<p>This can confuse users who may not understand why a cleanly build Python is missing standard library modules.  In addition it introduces a possible security issue: <tt class="docutils literal"><span class="pre">site-packages</span></tt> can contain broken or even malicious code that may be, unbeknownst to the user, imported instead of the missing <em>stdlib</em> module.</p>
</div>
<div class="section" id="linux-and-other-distributions">
<h2><a class="toc-backref" href="#id11">Linux and other distributions</a></h2>
<p>Many Linux and other distributions are already separating out parts of the standard library to standalone packages.  Among the most commonly excluded modules are the <tt class="docutils literal">TkInter</tt> module, since it draws in a dependency on the graphical environment, and the <tt class="docutils literal">test</tt> module, as it only serves to test Python internally and is about as big as the rest of the standard library put together.</p>
<p>The methods of omission of these modules differ.  For example, Debian patches the file <tt class="docutils literal">Lib/tkinter/__init__.py</tt> to envelop the line <tt class="docutils literal">import _tkinter</tt> in a <em>try-except</em> block and upon encountering an <tt class="docutils literal">ImportError</tt> it simply adds the following to the error message: <tt class="docutils literal">please install the <span class="pre">python3-tk</span> package</tt> <a class="footnote-reference" href="#debian-patch" id="id1">[1]</a>.  Fedora and other distributions simply don't include the omitted modules, potentially leaving users baffled as to where to find them.</p>
<p>In addition, both these methods also introduce the aforementioned security issue of possibly importing an insecure <tt class="docutils literal"><span class="pre">site-packages</span></tt> module in lieu of the missing <em>stdlib</em> module.</p>
</div>
</div>
<div class="section" id="specification">
<h1><a class="toc-backref" href="#id12">Specification</a></h1>
<!-- The technical specification should describe the syntax and semantics of any new language feature.  The specification should be detailed enough to allow competing, interoperable implementations for at least the current major Python platforms (CPython, Jython, IronPython, PyPy). -->
<p>When, for any reason, a standard library module is not to be included with the rest, a file with it's name and an extension <tt class="docutils literal">.missing.py</tt> should be created and placed in the <em>stdlib</em> directory or any other location on <tt class="docutils literal">sys.path</tt> the module would have occupied.</p>
<p>When Python tries to import a module <tt class="docutils literal">XYZ</tt>, it goes through the entries in <tt class="docutils literal">sys.path</tt> and in each location looks for a file whose name is <tt class="docutils literal">XYZ</tt> with one of the valid Python extensions (<tt class="docutils literal"><span class="pre">.*.so</span></tt>, <tt class="docutils literal">.so</tt>, <tt class="docutils literal">.py</tt>, <tt class="docutils literal"><span class="pre">.*.pyc</span></tt>, <tt class="docutils literal">.pyc</tt>).  If none of them are found in the currently searched location, Python will now continue by looking for a file named <tt class="docutils literal">XYZ.missing.py</tt> in the same location, and import it if found.  Due to looking for the <tt class="docutils literal">.missing.py</tt> file last in each <tt class="docutils literal">sys.path</tt> location, the missing file will never shadow an actually installed module in any given location.</p>
<p>The file with the <tt class="docutils literal">.missing.py</tt> extension can contain anything the distributor wishes, however, it <em>should</em> raise an <tt class="docutils literal">ImportError</tt> with a helpful error message.</p>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id13">Rationale</a></h1>
<!-- The rationale fleshes out the specification by describing what motivated the design and why particular design decisions were made.  It should describe alternate designs that were considered and related work, e.g. how the feature is supported in other languages.
The rationale should provide evidence of consensus within the community and discuss important objections or concerns raised during discussion. -->
<p>The mechanism of handling missing standard library modules through the use of the <tt class="docutils literal">.missing.py</tt> files was chosen due to its advantages both for CPython itself and for Linux and other distributions that are packaging it.</p>
<p>First, this implementation solves the security issue of importing, unbeknownst to the user, a possibly insecure module from <tt class="docutils literal"><span class="pre">site-packages</span></tt> instead of the missing standard library module.  Now, Python will import the <tt class="docutils literal">.missing.py</tt> file and won't ever look for a <em>stdlib</em> module in <tt class="docutils literal"><span class="pre">site-packages</span></tt>.</p>
<p>Another advantage is that the standard library module can be subsequently installed simply by putting the module file in it's appropriate location, which will then take precedence over the corresponding <tt class="docutils literal">.missing.py</tt> file.</p>
<p>In addition, this method of handling missing <em>stdlib</em> modules can be implemented in a succinct, non-intrusive way in CPython, and thus won't add to the complexity of the existing code base.</p>
<p>Lastly, due to the nature of handling missing <em>stdlib</em> modules through the use of separate <tt class="docutils literal">.missing.py</tt> files, the content of the file can be customized by the packager to provide any desirable behaviour.  Beginning with providing a tailor-made, actionable error message—e.g. <em>&quot;To use tkinter, please run `dnf install python3-tkinter`&quot;</em>—and possibly ending with automatic installation of the missing module.</p>
<p>The idea behind this PEP was discussed on the <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2016-July/145534.html">python-dev mailing list</a> <a class="footnote-reference" href="#id2" id="id3">[2]</a>.</p>
</div>
<div class="section" id="backwards-compatibility">
<h1><a class="toc-backref" href="#id14">Backwards Compatibility</a></h1>
<p>No problems with backwards compatibility are expected.  Distributions that are already patching Python modules to provide custom handling of missing dependencies can continue to do so unhindered.</p>
</div>
<div class="section" id="reference-implementation">
<h1><a class="toc-backref" href="#id15">Reference Implementation</a></h1>
<p>Reference implementation can be found on <a class="reference external" href="https://github.com/torsava/cpython/pull/1">GitHub</a> <a class="footnote-reference" href="#id4" id="id5">[3]</a> and is also accessible in the form of a <a class="reference external" href="https://github.com/torsava/cpython/pull/1.patch">patch</a> <a class="footnote-reference" href="#id6" id="id7">[4]</a>.</p>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id16">References</a></h1>
<table class="docutils footnote" frame="void" id="debian-patch" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="http://bazaar.launchpad.net/~doko/python/pkg3.5-debian/view/head:/patches/tkinter-import.diff">http://bazaar.launchpad.net/~doko/python/pkg3.5-debian/view/head:/patches/tkinter-import.diff</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[2]</a></td><td><a class="reference external" href="https://mail.python.org/pipermail/python-dev/2016-July/145534.html">https://mail.python.org/pipermail/python-dev/2016-July/145534.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[3]</a></td><td><a class="reference external" href="https://github.com/torsava/cpython/pull/1">https://github.com/torsava/cpython/pull/1</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[4]</a></td><td><a class="reference external" href="https://github.com/torsava/cpython/pull/1.patch">https://github.com/torsava/cpython/pull/1.patch</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id17">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
coding: utf-8
End: -->
</div>

</div>
</body>
</html>
